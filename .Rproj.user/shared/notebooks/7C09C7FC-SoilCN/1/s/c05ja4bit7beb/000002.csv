"0","rm(list=ls())"
"0","require(deSolve)"
"0","#----- The differential equations -----"
"0","sir <- function(t, x, p) {"
"0","  with(as.list(c(x,p)),{"
"0","    "
"0","    dCl <- ADD + BD - DECl # Carbon litter pool (eq 4)"
"0","    dCh <- rh*DECl - DECh #Humus pool C (eq 8)"
"0","    dCb <- (1-rh-rr)*DECl + (1-rr)*DECh - BD # Microbial biomass pool (eq 11)"
"0","    dNl <- ADD/CNadd + BD/CNbio - DECl/CNl # C Nitrogen litter pool (eq 7)"
"0","    dNh <- rh*(DECl/CNh) - (DECh/CNh) # Humus pool N (eq 10)"
"0","    dNb <- (1-rh*CNl/CNh)*DECl/CNl + DECh/CNh - BD/CNbio - phi # N Microbial biomass pool (eq 12)"
"0","    dNplus <- MIN - IMMplus - NIT - LEplus - UPplus # eq 24 CHECK"
"0","    dNminus <- NIT - IMMminus - LEminus - UPminus # eq 25 CHECK"
"0","    #Ctot <- dCl+dCh+dCb"
"0","    #Ntot <- dNl+dNh+dNb+dNplus+dNminus"
"0","    "
"0","    list(c(dCl, dCh, dCb, dNl, dNh, dNb, dNplus, dNminus"
"0","           #, Ctot, Ntot"
"0","           ))"
"0","  })"
"0","}"
"0",""
"0","# Initial conditions "
"0","Cl_0 <- 960   #carbon concentration  litter pool (960 - 1400)"
"0","Ch_0 <- 8500  #carbon concentration humus pool;"
"0","Cb_0 <- 48 #12.5 #carbon concentration biomass pool;"
"0","Nl_0 <- 960 #organic nitrogen concentration  litter pool;"
"0","Nh_0 <- 8500 #organic nitrogen concentration humus pool;"
"0","Nb_0 <- 48 #organic nitrogen concentration biomass pool;"
"0","Nplus_0 <-0.01 #0.01  #ammonium concentration soil;"
"0","Nminus_0 <-1.25 #nitrate concentration soil"
"0",""
"0","#Parameters"
"0","## Soil parameters"
"0","n <- 0.4 ### Porosity n 0.4"
"0","sfc <- 0.3 ###Field capacity sfc 0.3"
"0","sh <- 0.02 ### Hygroscopic point sh 0.02"
"0","ks <- 1.1### Sat. hydr. conductivity Ks (m d1) 1.1"
"0","Zr <- 0.80 ### Soil depth Zr (m) 0.80"
"0",""
"0","## Rainfall parameters"
"0","landa<- 0.23###Average storm frequency k (d1) 0.23"
"0","alpha <- 11 ###Average storm depth a (mm) 11"
"0",""
"0","## Vegetation parameters"
"0","Emax <- 4.5 ###Max. evapotranspiration Emax (mm d1) 4.5"
"0","ADD <- 1.5 ###Added litter (avg. rate) Add (gC m2 d1) 1.5 #rate at which carbon is added to soil and made available to microbial colonies"
"0",""
"0","## Soil-veg. parameters"
"0","ss <- 0.17 ###Point of incipient stress s 0.17"
"0","sw <- 0.065 ###Permanent wilting point sw 0.065"
"0",""
"0","##C/N ratios"
"0","CNadd <- 58 ### Added litter ðC=NÞadd 58"
"0","CNbio <- 11.5 ###Microbial biomass ðC=NÞbio 11.5 ## C/Nb = 8"
"0","CNh <- 22 ###Humus ðC=NÞh 22 #C/Nh = 10"
"0","  "
"0","# Parameters calibration"
"0",""
"0","aplus <- 0.05"
"0","aminus <- 1"
"0","DEMplus <- 0.2"
"0","DEMminus <- 0.5"
"0","dd <- 3"
"0","F <- 0.1"
"0","kd <- 0.0085"
"0","kl <- 0.000065"
"0","kiplus <- 1"
"0","kiminus <-  1"
"0","kh <- 0.0000025"
"0","kn <-  0.6"
"0","rh <- 0.2"
"0","rr <- 0.6"
"0","  "
"0","## Parameters 2"
"0","BD =  kd*CNbio #rate which carbon returns to litter pool due to dead microbe"
"0","phi = 0.67 #nondimentional factor accounting for reduction of decomp rate when poor nitrogen levels insufficiant to integrate in bacteria"
"0","s = 0.11 #average soil moisture"
"0","fds = if(s<=sfc){s/sfc"
"0","} else if(s>sfc){sfc/s}"
"0","Cl=960"
"0","Ch=8500"
"0","DECl = (phi*fds*kl*CNbio)*Cl #carbon output due to microbial decomp"
"0","DECh = (phi*fds*kh*CNbio)*Ch #"
"0","rr = 0.6"
"0","rh = 0.2 # 0.15-0.35"
"0","IMMplus = 0.67"
"0","IMMminus = 1 - IMMplus #Max 1, 0.67 and 0"
"0","#(C/N)h = 10"
"0","#(C/N)b = 8"
"0","CNl = 40"
"0","MIN = 1 #0"
"0","fns = if(s<=sfc){s/sfc"
"0","} else if(s>sfc){(1-s)/(1-sfc)}"
"0","NIT = fns*kn*CNbio*Nplus_0"
"0","b= 2.25 #?"
"0","beta=2*b+4"
"0","Ls=(ks/(exp((beta)*(1-sfc))-1)*(exp((beta)*(s-sfc))-1))"
"0","LEplus = aplus*(Ls/s*n*Zr) #Ls leakage term"
"0","LEminus = aminus*(Ls/s*n*Zr) "
"0","Tmax= 4.5"
"0","Ts=if(0<=s&&s<=sw){0"
"0","} else if(sw<s&&s<=ss){(s-sw)/(ss-sw)*Tmax"
"0","} else if(ss<s&&s<=1){Tmax}"
"0","UPpplus=aplus*(Ts/s*n*Zr)*Nplus_0"
"0","UPpminus=aminus*(Ts/s*n*Zr)*Nminus_0"
"0","d=3"
"0","kuplus=(aplus/s*n*Zr)*F*s^d"
"0","kuminus=(aminus/s*n*Zr)*F*s^d"
"0","UPaplus= if(DEMplus-UPpplus<0){0"
"0","} else if(kuplus*Nplus_0<DEMplus-UPpplus){kuplus*Nplus_0"
"0","} else if(kuplus*Nplus_0>DEMplus-UPpplus&&DEMplus-UPpplus>0){DEMplus-UPpplus}"
"0","UPaminus = if(DEMminus-UPpminus<0){0"
"0","} else if(kuminus*Nminus_0<DEMminus-UPpminus){kuminus*Nminus_0"
"0","} else if(kuminus*Nmius_0>DEMminus-UPpminus&&DEMminus-UPpminus>0){DEMminus-UPpminus}"
"0","UPplus = aplus*(Ts/s*n*Zr)*Nplus_0"
"0","UPminus = aminus*(Ts/s*n*Zr)*Nminus_0"
"0",""
"0",""
"0","times <- seq(0, 5000.0, 1) # Time sequence"
"0","parms <- c(ADD=ADD, "
"0","           alpha=alpha,"
"0","           aminus=aminus,"
"0","           aplus=aplus,"
"0","           b=b,"
"0","           BD=BD,"
"0","           beta=beta,"
"0","           #Cb_0=Cb_0,"
"0","           Ch=Ch,"
"0","           #Ch_0=Ch_0,"
"0","           Cl=Cl,"
"0","           #Cl_0=Cl_0,"
"0","           CNadd=CNadd,"
"0","           CNbio=CNbio,"
"0","           CNh=CNh,"
"0","           d=d,"
"0","           dd=dd,"
"0","           DECh=DECh,"
"0","           DECl=DECl,"
"0","           DEMminus=DEMminus,"
"0","           DEMplus=DEMplus,"
"0","           Emax=Emax,"
"0","           F=F,"
"0","           fds=fds,"
"0","           IMMplus=IMMplus,"
"0","           IMMminus=IMMminus,"
"0","           kd=kd,"
"0","           kh=kh,"
"0","           kiminus=kiminus,"
"0","           kiplus=kiplus,"
"0","           kl=kl,"
"0","           kn=kn,"
"0","           ks=ks,"
"0","           kuminus=kuminus,"
"0","           kuplus=kuplus,"
"0","           landa=landa,"
"0","           LEminus=LEminus,"
"0","           LEplus=LEplus,"
"0","           Ls=Ls,"
"0","           MIN=MIN,"
"0","           n=n,"
"0","           NIT=NIT,"
"0","           phi=phi,"
"0","           rh=rh,"
"0","           rr=rr,"
"0","           s=s,"
"0","           sfc=sfc,"
"0","           sh=sh,"
"0","           ss=ss,"
"0","           sw=sw,"
"0","           Zr=Zr)"
"0","xstart <- c(Cl=Cl_0, Ch=Ch_0, Cb=Cb_0, Nl=Nl_0, Nh=Nh_0, Nb=Nb_0, Nplus=Nplus_0, Nminus=Nminus_0) # Initial conditions"
"0","my.atol <- c(1e-16,1e-16,1e-16,1e-16,1e-16,1e-16,1e-16,1e-16); # Abs. accuracy - remember to add a term for each equation"
"0","my.rtol <- 1e-12 # Rel. accuracy"
"0","out <- as.data.frame(lsoda(xstart, times,"
"0","                           sir, parms, my.rtol, my.atol)) # Solve the eqns."
